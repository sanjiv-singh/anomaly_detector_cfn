{
    "AWSTemplateFormatVersion" : "2010-09-09",
    "Description": "Task 1",
    "Parameters": {
        "EmailAddress": {
            "Description": "Email address to be used as endpoint for SNS",
            "Type": "String"
        }
    },
    "Resources": {
        "Task1KinesisStream": {
            "Type" : "AWS::Kinesis::Stream",
            "Properties" : {
                "Name" : "RawDataStream",
                "ShardCount": 1
            }
        },
        "Task1DynamoDBTable" : {
            "Type" : "AWS::DynamoDB::Table",
            "Properties" : {
              "TableName" : "bsm-alert-data",
              "AttributeDefinitions" : [
                {
                  "AttributeName" : "deviceid",
                  "AttributeType" : "S"   
                },
                {
                  "AttributeName" : "timestamp",
                  "AttributeType" : "S"
                }
              ],
              "KeySchema" : [
                {
                  "AttributeName" : "deviceid",
                  "KeyType" : "HASH"
                },
                {
                  "AttributeName" : "timestamp",
                  "KeyType" : "RANGE"
                }
              ],
              "ProvisionedThroughput" : {
                "ReadCapacityUnits" : "5",
                "WriteCapacityUnits" : "5"
              }
            }
        },
        "BSMSNSTopic": {
            "Type": "AWS::SNS::Topic",
            "Properties": {
              "DisplayName": "BSMAlert",
              "Subscription": [  ],
              "TopicName": "BSMAlert"
            }
        },
        "MySubscription" : {
            "Type" : "AWS::SNS::Subscription",
            "Properties" : {
                "Endpoint" : {"Ref": "EmailAddress"},
                "Protocol" : "email",
                "TopicArn" : { "Ref" : "BSMSNSTopic" }
            },
            "DependsOn": "BSMSNSTopic"
        }
    }
} 